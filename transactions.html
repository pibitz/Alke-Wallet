<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alke Wallet - Últimos Movimientos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <style>
        body {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
        }

        .container {
            background: rgba(159, 237, 188, 0.358);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(5, 5, 5, 0.2);
            padding: 40px;
            max-width: 600px;
            margin: 0 auto;
        }

        h2 {
            color: #333;
            text-align: center;
            margin: 0 0 10px 0;
            font-size: 28px;
        }

        .btn-menus {
            background: rgba(255,255,255,0.3);
            border: 2px solid white;
            color: white;
            border-radius: 10px;
            padding: 10px 20px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .btn-menus:hover {
            background: white;
            color: #f5576c;
        }

        .balance-summary {
            background: rgba(255, 255, 255, 0.5);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }

        .balance-summary h5 {
            margin: 0;
            color: #333;
        }

        .filter-section {
            background: rgba(255, 255, 255, 0.6);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .filter-section label {
            font-weight: bold;
            color: #ff8a9e;
            margin-bottom: 8px;
        }

        .no-transactions {
            background: rgba(255, 255, 255, 0.7);
            padding: 40px;
            border-radius: 10px;
            text-align: center;
            color: #666;
        }

        .transaction-card {
            margin-bottom: 15px;
            background: linear-gradient(135deg, #a3edff 0%, #ff9fd4 100%);
            border: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        .transaction-card:hover {
            background: #b7edff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .concepto-text {
            font-size: 0.85rem;
            color: #6c757d;
            margin-top: 5px;
        }

        .transaction-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.6);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-card h6 {
            color: #666;
            margin: 0 0 5px 0;
            font-size: 0.9rem;
        }

        .stat-card .stat-value {
            font-size: 1.3rem;
            font-weight: bold;
            margin: 0;
        }

        .stat-card.deposits .stat-value {
            color: #28a745;
        }

        .stat-card.withdrawals .stat-value {
            color: #dc3545;
        }
    </style>
</head>

<body>
    <div class="container">
        <h2>Últimos Movimientos</h2>

        <!-- Resumen de saldo -->
        <div class="balance-summary">
            <p class="mb-2">Saldo Actual</p>
            <h5 id="saldoActual">$0.00</h5>
            <small class="text-muted">Total de transacciones: <span id="totalTransacciones">0</span></small>
        </div>

        <!-- Estadísticas de transacciones -->
        <div class="transaction-stats">
            <div class="stat-card deposits">
                <h6>Total Depósitos</h6>
                <p class="stat-value" id="totalDepositos">$0.00</p>
            </div>
            <div class="stat-card withdrawals">
                <h6>Total Envíos</h6>
                <p class="stat-value" id="totalEnvios">$0.00</p>
            </div>
        </div>

        <!-- Filtro por tipo de movimiento -->
        <div class="filter-section">
            <label for="filtroTipo">Filtrar por tipo de movimiento:</label>
            <select class="form-select" id="filtroTipo">
                <option value="todos">Todos los movimientos</option>
                <option value="deposito">Depósitos</option>
                <option value="envio">Envíos</option>
            </select>
        </div>

        <!-- Lista de transacciones -->
        <div id="listaTransacciones"></div>

        <a href="menu.html" class="btn btn-menus">Volver al Menú Principal</a>
    </div>

    <!--BootStrap-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    
    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <script>
        $(document).ready(function() {
            // Verificar si el usuario está logueado
            if (!localStorage.getItem('userLoggedIn')) {
                window.location.href = 'login.html';
            }

            // Cargar saldo actual con jQuery
            const saldoActual = parseFloat(localStorage.getItem('balance')) || 60000;
            $('#saldoActual').text('$' + saldoActual.toLocaleString('es-ES', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }));

            // Cargar transacciones desde localStorage
            let transacciones = JSON.parse(localStorage.getItem('transactions')) || [];

            // Si no hay transacciones, crear algunas de ejemplo
            if (transacciones.length === 0) {
                transacciones = [
                    {
                        id: 1,
                        type: 'Depósito',
                        amount: 5000,
                        date: new Date(Date.now() - 86400000).toLocaleString('es-ES'),
                        status: 'success',
                        concepto: 'Depósito inicial'
                    },
                    {
                        id: 2,
                        type: 'Envío a Connie Vergara',
                        amount: -1250,
                        date: new Date(Date.now() - 172800000).toLocaleString('es-ES'),
                        status: 'success',
                        concepto: 'Pago de servicio'
                    },
                    {
                        id: 3,
                        type: 'Depósito',
                        amount: 10000,
                        date: new Date(Date.now() - 259200000).toLocaleString('es-ES'),
                        status: 'success',
                        concepto: 'Transferencia recibida'
                    }
                ];
            }

            // Función para obtener el tipo de transacción
            function getTipoTransaccion(transaccion) {
                if (transaccion.amount > 0) {
                    return 'deposito';
                } else {
                    return 'envio';
                }
            }

            // Calcular totales de depósitos y envíos
            function calcularTotales() {
                let totalDepositos = 0;
                let totalEnvios = 0;

                $.each(transacciones, function(index, t) {
                    if (t.amount > 0) {
                        totalDepositos += t.amount;
                    } else {
                        totalEnvios += Math.abs(t.amount);
                    }
                });

                $('#totalDepositos').text('$' + totalDepositos.toLocaleString('es-ES', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }));

                $('#totalEnvios').text('$' + totalEnvios.toLocaleString('es-ES', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }));
            }

            // Función para mostrar últimos movimientos según filtro usando jQuery
            function mostrarUltimosMovimientos(filtro) {
                const $lista = $('#listaTransacciones');
                
                // Filtrar transacciones según el tipo seleccionado
                let transaccionesFiltradas = transacciones;

                if (filtro === 'deposito') {
                    transaccionesFiltradas = transacciones.filter(t => t.amount > 0);
                } else if (filtro === 'envio') {
                    transaccionesFiltradas = transacciones.filter(t => t.amount < 0);
                }

                // Si no hay transacciones después del filtro
                if (transaccionesFiltradas.length === 0) {
                    $lista.html(`
                        <div class="no-transactions">
                            <h5>No hay movimientos de este tipo</h5>
                            <p>Selecciona otro filtro para ver más transacciones</p>
                        </div>
                    `);
                    return;
                }

                // Limpiar lista y crear cards con jQuery
                $lista.empty();

                $.each(transaccionesFiltradas, function(index, transaccion) {
                    const esDeposito = transaccion.amount > 0;
                    const colorMonto = esDeposito ? 'text-success' : 'text-danger';
                    const signo = esDeposito ? '+' : '';
                    const icono = esDeposito ? '↓' : '↑';

                    const $card = $('<div>', {
                        class: 'card transaction-card'
                    }).html(`
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1">
                                    <h6 class="card-title mb-1">
                                        <span style="font-size: 1.2rem; margin-right: 8px;">${icono}</span>
                                        ${transaccion.type}
                                    </h6>
                                    <p class="card-text text-muted mb-0">
                                        <small>${transaccion.date}</small>
                                    </p>
                                    ${transaccion.concepto ? `
                                        <p class="concepto-text mb-0">
                                            <i>Concepto: ${transaccion.concepto}</i>
                                        </p>
                                    ` : ''}
                                </div>
                                <div class="text-end">
                                    <h5 class="${colorMonto} mb-0">
                                        ${signo}$${Math.abs(transaccion.amount).toLocaleString('es-ES', {
                                            minimumFractionDigits: 2,
                                            maximumFractionDigits: 2
                                        })}
                                    </h5>
                                    <small class="badge bg-success">${transaccion.status === 'success' ? 'Completado' : 'Pendiente'}</small>
                                </div>
                            </div>
                        </div>
                    `);

                    // Agregar animación fadeIn con jQuery
                    $card.hide().appendTo($lista).fadeIn(300);
                });
            }

            // Actualizar total de transacciones con jQuery
            $('#totalTransacciones').text(transacciones.length);

            // Calcular totales
            calcularTotales();

            // Evento para el filtro usando jQuery
            $('#filtroTipo').on('change', function() {
                const filtro = $(this).val();
                mostrarUltimosMovimientos(filtro);
            });

            // Inicializar - mostrar todas las transacciones
            mostrarUltimosMovimientos('todos');
        });
    </script>
</body>
</html>